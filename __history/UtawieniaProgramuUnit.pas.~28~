unit UtawieniaProgramuUnit;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Error, FireDAC.UI.Intf, FireDAC.Phys.Intf, FireDAC.Stan.Def,
  FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.Phys, FireDAC.Phys.SQLite,
  FireDAC.Phys.SQLiteDef, FireDAC.Stan.ExprFuncs, FireDAC.VCLUI.Wait,
  FireDAC.Stan.Param, FireDAC.DatS, FireDAC.DApt.Intf, FireDAC.DApt, Data.DB,
  Vcl.Grids, Vcl.DBGrids, FireDAC.Comp.DataSet, FireDAC.Comp.Client;

type
  TUtawieniaProgramuForm = class(TForm)
    FDConnection1: TFDConnection;
    FDQuery1: TFDQuery;
    DBGrid1: TDBGrid;
    DataSource1: TDataSource;
    procedure FormCreate(Sender: TObject);
    procedure FormKeyPress(Sender: TObject; var Key: Char);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  UtawieniaProgramuForm: TUtawieniaProgramuForm;

implementation

{$R *.dfm}


procedure TUtawieniaProgramuForm.FormCreate(Sender: TObject);
var
  Cnt: Integer;
begin
KeyPreview := true;

  FDConnection1.Connected := True;

  // tworzymy tabelę z trzema kolumnami
  FDConnection1.ExecSQL(
    'CREATE TABLE IF NOT EXISTS ustawienia (' +
    'id INTEGER PRIMARY KEY AUTOINCREMENT, ' +
    'nazwa VARCHAR(80), ' +
    'wartosc VARCHAR(80))'
  );

  // sprawdzamy, czy są dane
  Cnt := FDConnection1.ExecSQLScalar('SELECT COUNT(*) FROM ustawienia');

  // jeśli brak danych, dodajemy trzy wpisy przykładowe
  if Cnt = 0 then
  begin
   FDConnection1.ExecSQL(
      'INSERT INTO ustawienia (nazwa, wartosc) VALUES ' +
      '("Opakowania DRS: sposób tworzenia kodu własnego", "wg konfiguracji zwykłego kodu własnego"), ' +
      '("Opakowania DRS: wykorzystanie zwolnionych kodów", "tak"), ' +
      '("Opakowania DRS: przedrostek kodu własnego EAN (200..209)", "200"), ' +
      '("Opakowania DRS: pierwszy numer kodu własnego", "1001")'
    );
  end;

  // podłączamy zapytanie do siatki
  FDQuery1.Connection := FDConnection1;
  FDQuery1.SQL.Text := 'SELECT * FROM ustawienia';
  FDQuery1.Open;

  DBGrid1.Options := DBGrid1.Options + [dgRowSelect] - [dgEditing];
end;


procedure TUtawieniaProgramuForm.FormKeyPress(Sender: TObject; var Key: Char);
begin
 if Key = #27 then Close;
end;

end.
