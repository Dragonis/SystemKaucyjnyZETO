unit Towary;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes,
  Vcl.Graphics, Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Data.DB,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param, FireDAC.Stan.Error,
  FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf, FireDAC.Stan.Async,
  FireDAC.DApt, FireDAC.UI.Intf, FireDAC.Stan.Def, FireDAC.Stan.Pool,
  FireDAC.Phys, FireDAC.VCLUI.Wait, FireDAC.Comp.ScriptCommands, FireDAC.Stan.Util,
  FireDAC.Comp.Script, FireDAC.Comp.Client, FireDAC.Comp.DataSet,
  Vcl.Grids, Vcl.DBGrids, FireDAC.Phys.SQLite, FireDAC.Phys.SQLiteDef,
  FireDAC.Stan.ExprFuncs, CompanyInfo, Vcl.StdCtrls, SzczeegolyProduktuUnit, System.IniFiles;

type
  TTowaryForm = class(TForm)
    DBGrid1: TDBGrid;
    FDQuery1: TFDQuery;
    FDConnection1: TFDConnection;
    DataSource1: TDataSource;
    LabelNIP: TLabel;
    LabelName: TLabel;
    LabelStatus: TLabel;
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    LabelRegon: TLabel;
    LabelKRS: TLabel;
    LabelAdres: TLabel;
    Label4: TLabel;
    Label5: TLabel;
    Label6: TLabel;
    procedure FormCreate(Sender: TObject);
    procedure FormKeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
    procedure DBGrid1DblClick(Sender: TObject);
    procedure FormActivate(Sender: TObject);
  private
    FCompany: TCompanyInfo;
  public
    procedure SetCompanyInfo(const ACompany: TCompanyInfo);
  end;

var
  TowaryForm: TTowaryForm;

implementation

{$R *.dfm}

procedure TTowaryForm.DBGrid1DblClick(Sender: TObject);
var
  ProduktID, ProduktIlosc: Integer;
  ProduktNazwa: string;
begin
  if DataSource1.DataSet.IsEmpty then Exit;

  ProduktID := DataSource1.DataSet.FieldByName('id').AsInteger;
  ProduktNazwa := DataSource1.DataSet.FieldByName('nazwa').AsString;
  ProduktIlosc := DataSource1.DataSet.FieldByName('ilosc').AsInteger;

  if Assigned(ProduktForm) then
  begin
    ProduktForm.UstawDane(ProduktID, ProduktNazwa, ProduktIlosc);
    ProduktForm.ShowModal;
  end;
end;

procedure ShowMessageOnce(const MsgID, MsgText: string);
var
  Ini: TIniFile;
  frm: TForm;
  lbl: TLabel;
  chk: TCheckBox;
  btn: TButton;
  ShowAgain: Boolean;
  IniFileName: string;
begin
  IniFileName := ExtractFilePath(ParamStr(0)) + 'settings.ini';
  Ini := TIniFile.Create(IniFileName);
  try
    ShowAgain := Ini.ReadBool('Messages', MsgID, True);
    if not ShowAgain then Exit;

    frm := TForm.Create(nil);
    try
      frm.Width := 400;
      frm.Height := 150;
      frm.Position := poScreenCenter;
      frm.Caption := 'Informacja';
      frm.BorderStyle := bsDialog;

      lbl := TLabel.Create(frm);
      lbl.Parent := frm;
      lbl.Caption := MsgText;
      lbl.Left := 20; lbl.Top := 20; lbl.Width := 360;

      chk := TCheckBox.Create(frm);
      chk.Parent := frm;
      chk.Caption := 'Nie pokazuj więcej';
      chk.Left := 20; chk.Top := 60;

      btn := TButton.Create(frm);
      btn.Parent := frm;
      btn.Caption := 'OK';
      btn.ModalResult := mrOk;
      btn.Left := frm.ClientWidth - btn.Width - 20;
      btn.Top := frm.ClientHeight - btn.Height - 20;

      if frm.ShowModal = mrOk then
        Ini.WriteBool('Messages', MsgID, not chk.Checked); // zapisujemy decyzję
    finally
      frm.Free;
    end;
  finally
    Ini.Free;
  end;
end;


procedure TTowaryForm.FormActivate(Sender: TObject);
begin
ShowMessageOnce('WelcomeMessage', 'Witaj w aplikacji!');
end;

procedure TTowaryForm.FormCreate(Sender: TObject);
begin
  Self.KeyPreview := True;

  try
    FDConnection1.Connected := True;
    FDQuery1.SQL.Text := 'SELECT * FROM Produkty';
    FDQuery1.Open;
  except
    on E: Exception do
      MessageDlg('Błąd połączenia z bazą danych lub odczytu danych: ' + E.Message,
        mtError, [mbOK], 0);
  end;



end;

procedure TTowaryForm.SetCompanyInfo(const ACompany: TCompanyInfo);
begin
  FCompany := ACompany;
  LabelName.Caption := FCompany.Name;
  LabelNIP.Caption := FCompany.Nip;
  LabelStatus.Caption := FCompany.StatusVat;
  LabelRegon.Caption := FCompany.Regon;
  LabelKRS.Caption := FCompany.Krs;
  LabelAdres.Caption := FCompany.WorkingAddress;
end;


procedure TTowaryForm.FormKeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
begin
  if Key = VK_ESCAPE then
    Close;
end;

end.

