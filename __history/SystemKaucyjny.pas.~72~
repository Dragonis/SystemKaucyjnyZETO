unit SystemKaucyjny;
interface

uses
  Winapi.Windows, Winapi.Messages,
  System.SysUtils, System.Variants, System.Classes,
  Vcl.Graphics, Vcl.Controls, Vcl.Forms, Vcl.Dialogs,
  Data.DB,
  Vcl.Grids, Vcl.DBGrids,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Error,
  FireDAC.UI.Intf, FireDAC.Phys.Intf, FireDAC.Stan.Def,
  FireDAC.Stan.Pool, FireDAC.Stan.Async,
  FireDAC.Phys, FireDAC.VCLUI.Wait,
  FireDAC.Stan.Param, FireDAC.DatS, FireDAC.DApt.Intf,
  FireDAC.DApt, FireDAC.Comp.DataSet, FireDAC.Comp.Client,
  FireDAC.Phys.SQLite, FireDAC.Phys.SQLiteDef,
  FireDAC.Stan.ExprFuncs,
  Vcl.StdCtrls,

  SzczeegolyProduktuUnit,
  FrakcjeDRS,
  UstawieniaProgramu,

   Vcl.StdCtrls;

type
  TSystemKaucyjnyForm = class(TForm)
    FDConnection1: TFDConnection;
    FDQuery1: TFDQuery;
    DataSource1: TDataSource;
    DBGrid1: TDBGrid;
    ButtonFrakcjeDRS: TButton;
    Button1: TButton;
    procedure FormCreate(Sender: TObject);
    procedure DBGrid1DblClick(Sender: TObject);
    procedure Button1Click(Sender: TObject);
    procedure ButtonFrakcjeDRSClick(Sender: TObject);
  private

  end;

var
  SystemKaucyjnyForm: TSystemKaucyjnyForm;

implementation

{$R *.dfm}

procedure TSystemKaucyjnyForm.FormCreate(Sender: TObject);
var
  Cnt: Integer;
begin
  FDConnection1.Connected := True;

  // tabela
  FDConnection1.ExecSQL(
    'CREATE TABLE IF NOT EXISTS items (' +
    'id INTEGER PRIMARY KEY AUTOINCREMENT,' +
    'nazwa VARCHAR(30),' +
    'ilosc INTEGER)'
  );

  // sprawdź czy są dane
  Cnt := FDConnection1.ExecSQLScalar(
    'SELECT COUNT(*) FROM items'
  );

  // dane przykładowe
  if Cnt = 0 then
  begin
    FDConnection1.ExecSQL(
      'INSERT INTO items (nazwa, ilosc) VALUES ' +
      '("Butelka PET 0.5L", 120),' +
      '("Butelka PET 1.5L", 80),' +
      '("Butelka szklana 0.33L", 60),' +
      '("Butelka szklana 0.5L", 40),' +
      '("Puszka aluminiowa 0.33L", 200),' +
      '("Puszka aluminiowa 0.5L", 150),' +
      '("Skrzynka plastikowa", 25),' +
      '("Skrzynka drewniana", 10),' +
      '("Keg stalowy 30L", 5),' +
      '("Keg stalowy 50L", 3)'
    );
  end;

  // zapytanie
  FDQuery1.Connection := FDConnection1;
  FDQuery1.SQL.Text := 'SELECT * FROM items';
  FDQuery1.Open;

DBGrid1.Options := DBGrid1.Options + [dgRowSelect] - [dgEditing];

end;

procedure TSystemKaucyjnyForm.Button1Click(Sender: TObject);
begin
   UstawieniaProgramuForm.Show;
end;

procedure TSystemKaucyjnyForm.ButtonFrakcjeDRSClick(Sender: TObject);
begin
FrakcjeDRSForm.Show;
end;

procedure TSystemKaucyjnyForm.DBGrid1DblClick(Sender: TObject);
var
  NowyForm: TProduktForm;
  ProduktID, ProduktIlosc: Integer;
  ProduktNazwa: string;
begin
  if not DataSource1.DataSet.IsEmpty then
  begin
    ProduktID := DataSource1.DataSet.FieldByName('ID').AsInteger;
    ProduktNazwa := DataSource1.DataSet.FieldByName('Nazwa').AsString;
    ProduktIlosc := DataSource1.DataSet.FieldByName('Ilosc').AsInteger;

    NowyForm := TProduktForm.Create(Self);
    try
      NowyForm.UstawDane(ProduktID, ProduktNazwa, ProduktIlosc);
      NowyForm.ShowModal;
    finally
      NowyForm.Free;
    end;
  end;
end;





end.

